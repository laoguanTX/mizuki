---
title: 创建网络的分布层
published: 2024-11-13
category: ["其他课程基础", "无线网络应用"]
tags: ["网络"]
alias: "creatingnetworkdistributionlayer"
---

## 一、分布层

随着网络扩大，应将一个过大的本地网络分成多个接入层网络，然后用分布层设备如路由器进行互联。

分布层连接各个独立的接入层网络，并且控制它们之间的通信量流动。分布层典型设备是路由器。

分布层的网络设备用于连接网络，而非单独的主机！单独的主机通过接入层设备（交换机）连接到网络！接入层设备再通过分布层设备（路由器）相互连接！

分布层设备负责确保：（利用IP地址决定出去/不出去）本地接入层小网中各主机之间的通信量保留在本地不出去！只允许发往其它网络的通信量通过分布层设备转发出去！

## 二、路由器的特点

### 1、路由器的构造

所有型号的路由器实质上都是计算机！和计算机、平板电脑和智能设备一样，路由器也需要以下组成部分：

1. 中央处理器 (CPU)：执行操作系统指令，如系统初始化、路由功能和交换功能。
2. 操作系统 (OS)：Cisco Internetwork Operating System (IOS) 是用于多数思科设备的系统软件，无论这些设备的大小和类型。它用于路由器、LAN 交换机、小型无线接入点、具有几十个接口的大型路由器等设备。
3. 内存。包括：
   1. 随机访问存储器 (RAM)
   2. 只读存储器 (ROM)
   3. 非易失性随机访问存储器 (NVRAM)
   4. 闪存(Flash) 

### 2、LAN和WAN接口

路由器的网络接口，比一般计算机丰富，可分为两类：

1. LAN 接口 - 用于连接 LAN 设备（如计算机和交换机）上的电缆。此接口还可用于路由器之间的相互连接。几种常用的以太网接口命名约定是：Ethernet以太网(10M)、FastEthernet百兆以太网(100M)和GigabitEthernet千兆以太网(1G)。使用的名称取决于设备类型和型号。
2. WAN 接口 - 用于将路由器连接到外部网络（通常地理位置较远）。

控制台Console RJ45连接反转线（或称控制台电缆）。

LAN接口连接直通线或交叉线。

## 三、路由器的功能

### 1、路由器的工作过程

路由器Router是一种用于连接不同本地网络的分布层网络设备。

路由器与交换机一样，都可解码和读取收到的消息。但交换机只能拆包解码读数据帧中的MAC地址信息，而路由器可进一步拆包解码数据帧中封装的数据包内的IP地址信息（数据包中包含目的主机和源主机的IP地址、以及在它们之间发送的消息数据）。路由器就是读取数据包中的目的IP地址的网络部分，并拿它去查找转发消息到目的主机的最佳路由/路线。

路由器利用路由表查找确定发送消息到目的网络的路径。路由器的每个接口都连接到一个本地网络。每个路由器都包含一个路由表，里面有多条路由信息，每条路由包含三个要素：

1. 本路由器的一个 接口（作为出口）

2. 通过该接口能到达的目的网络地址

3. 这条路由/路线/路径的优劣信息

3.叫路由权值/度量/Metric，有时也叫Hop Count跳数，从源到目的的路径上经过的每一个路由器就称为一跳！路由器就是使用这些信息来指导数据到达目的网络！

当路由器收到一个帧时，就会对该帧进行解封装，然后将数据包中的目的IP地址的网络部分与路由表中各条路由的要素2.可到达的目的网络比较。如果在表中能找到一条目的网络地址对应的路由，路由器就将数据包封装在一个新帧中，然后将新帧从表中找到的这条路由的要素(1) 出口接口转发出去，因为路由表中这条路由说：通过该接口出去的这条路线最终能够到达目的网络。至于转发到目的网络之后如何到达目的主机，则由目的网络内的交换机及主机通过ARP过程来实现。

在Windows终端中使用指令`route print`或者`netstat -r`命令来输出路由表。![4](https://laoguantx.top/article/无线网络应用/第二次课/4.png)

### 2、路由器与广播的关系

路由器一般不会转发目的地址为广播IP地址的消息即广播消息（目的IP地址为255.255.255.255或仅其主机部分为全1）。

路由器有几个接口，即可划分几个广播域，由此可见：路由器分割广播域。

## 四、默认网关

必须在本地网络的每台主机上配置正确的默认网关。如果在主机TCP/IP设置中没有配置默认网关，或指定了错误的默认网关，便无法将消息发送到远程网络上的主机。默认网关就是本地网络的出口，要到外部网络去，必须且只能先到默认网关，然后再转出去。默认网关IP地址就是主机所在的本地网络直接连接着的那个路由器接口的IP地址。

当主机发送消息到远程网络（非本地网络）时，必须使用路由器。主机将目的主机IP地址包含在数据包中。但当它将数据包封装到帧中时，将用路由器接口（即默认网关）MAC地址作为该帧的目的MAC地址。这样，路由器就会根据该MAC地址接收并接受下该帧。

主机通过其TCP/IP设置中配置的默认网关地址获取路由器的IP地址。当主机知道默认网关IP地址之后，便可以使用ARP来确定其MAC地址。然后，它将路由器接口的MAC地址作为目的MAC地址加入要发送到其它网络的帧中，指挥该帧通过该路由器接口而转发到远程的外网去。

## 五、通信过程地址变化

数据在从源主机到目的主机的过程中，常需经多个路由器的中转即多跳或多段路才能到达。当到路由器时，先解封装旧帧找出目的IP地址，再取其网络部分对照查找路由表决定怎么走；而离开路由器时，要封装成新帧再发出去。每段路上的数据帧，不变的是源和目的IP地址（最初的源和最终的目的），而一直在变的是源和目的MAC地址（本段路的源和目的）。

因为MAC地址只在本地网络内有意义，源主机无法“一步登天”地知道远程网络中的目的主机的MAC地址（而且即使知道了也没用），为什么源主机不发ARP广播去问？因为路由器不转发ARP户播，所以问不到。
